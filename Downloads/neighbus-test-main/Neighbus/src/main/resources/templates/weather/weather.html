<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì˜¤ëŠ˜ì˜ ë‚ ì”¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/custom-modal.css">
    <script src="/js/custom-modal.js"></script>
    
    <style>
        body {
            /* ë°°ê²½: ì‚°ëœ»í•œ íŒŒë€ ê·¸ë¼ë°ì´ì…˜ */
            background: linear-gradient(135deg, #74ebd5, #ACB6E5);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
        }
        
        /* ìœ ë¦¬ íš¨ê³¼ ì¹´ë“œ ë””ìì¸ */
        .weather-card {
            background: rgba(255, 255, 255, 0.25); /* ë°˜íˆ¬ëª… í°ìƒ‰ */
            backdrop-filter: blur(10px);            /* ë¸”ëŸ¬ íš¨ê³¼ */
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            color: #333;
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            text-align: center;
        }

        .temp-text { font-size: 4rem; font-weight: 700; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .city-text { font-size: 1.5rem; color: #555; font-weight: bold; margin-bottom: 10px; }
        .weather-icon { width: 100px; height: 100px; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2)); }
        
        .btn-custom {
            background-color: rgba(255, 255, 255, 0.5);
            border: none;
            color: #333;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn-custom:hover { background-color: rgba(255, 255, 255, 0.8); transform: scale(1.05); }
    </style>
</head>
<body>

    <div class="weather-card">
        <div id="loading" class="spinner-border text-light my-5" role="status" style="display: none;">
            <span class="visually-hidden">Loading...</span>
        </div>

        <div id="weatherContent" style="display: block;"> <h2 class="mb-4 text-white">ğŸŒ¤ï¸ ì˜¤ëŠ˜ì˜ ë‚ ì”¨</h2>
            
            <div id="resultArea" style="display: none;">
                <img id="weatherIcon" src="" alt="ë‚ ì”¨ ì•„ì´ì½˜" class="weather-icon">
                <div id="cityName" class="city-text">ë„ì‹œ ì´ë¦„</div>
                <div class="temp-text"><span id="temp">0</span>Â°</div>
                <div id="desc" class="badge bg-light text-dark fs-5 mb-3">ë§‘ìŒ</div>
                
                <div class="d-flex justify-content-center gap-3 text-white">
                    <span>ğŸ’§ ìŠµë„ <span id="humidity">0</span>%</span>
                </div>
                <hr class="my-4 text-white">
            </div>

            <button class="btn btn-custom w-100 py-2" onclick="getLocation()">
                ğŸ“ í˜„ì¬ ìœ„ì¹˜ ë‚ ì”¨ ë³´ê¸°
            </button>
        </div>
    </div>

    <script>
        function getLocation() {
            // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ, ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            document.getElementById("loading").style.display = "inline-block";
            document.getElementById("resultArea").style.display = "none";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getWeatherByCoords, showError);
            } else {
                showModal('warning', 'ê¸°ëŠ¥ ë¯¸ì§€ì›', 'ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                resetUI();
            }
        }

        function getWeatherByCoords(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            fetch(`/weather/current?lat=${lat}&lon=${lon}`)
                .then(response => response.json())
                .then(data => {
                    // ë°ì´í„° ë°”ì¸ë”©
                    document.getElementById("cityName").innerText = data.city;
                    document.getElementById("temp").innerText = Math.round(data.temp); // ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼
                    document.getElementById("desc").innerText = data.desc;
                    document.getElementById("humidity").innerText = data.humidity;
                    
                    // â˜… ì•„ì´ì½˜ ì´ë¯¸ì§€ URL ì„¤ì •
                    const iconUrl = `https://openweathermap.org/img/wn/${data.icon}@4x.png`;
                    document.getElementById("weatherIcon").src = iconUrl;

                    // í™”ë©´ ì „í™˜
                    document.getElementById("loading").style.display = "none";
                    document.getElementById("resultArea").style.display = "block";
                })
                .catch(error => {
                    showModal('error', 'ì˜¤ë¥˜', 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    resetUI();
                });
        }

        function showError() {
            showModal('error', 'ì ‘ê·¼ ì°¨ë‹¨', 'ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            resetUI();
        }

        function resetUI() {
            document.getElementById("loading").style.display = "none";
        }
    </script>

</body>
</html>